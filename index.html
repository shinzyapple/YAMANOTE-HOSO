<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>文字検出で音声再生</title>
</head>
<body>
  <h2>Webカメラ文字認識</h2>
  <video id="video" width="400" height="300" autoplay playsinline></video>
  <canvas id="canvas" width="400" height="300" style="display:none;"></canvas>
  <p id="result">検出結果: </p>

  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const result = document.getElementById('result');

    const targetWord = "ありがとう"; // ← これを検出したら音声再生
    let detectedOnce = false;

    // カメラ起動
    navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
      video.srcObject = stream;
    }).catch(err => {
      alert("カメラにアクセスできません: " + err);
    });

    // 定期的に文字認識
    setInterval(() => {
      if (detectedOnce) return;

      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      Tesseract.recognize(canvas, 'jpn', {
        logger: m => console.log(m)
      }).then(({ data: { text } }) => {
        result.innerText = "検出結果: " + text;
        if (text.includes(targetWord)) {
          detectedOnce = true;
          speak(targetWord);
        }
      });
    }, 4000); // 4秒ごとにチェック

    // 音声読み上げ
    function speak(text) {
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'ja-JP';
      window.speechSynthesis.speak(utter);
    }
  </script>
</body>
</html>
